<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Chat Interface</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="chat-container">
        <div class="chat-history" id="chatHistory">
            <!-- Chat messages will appear here -->
        </div>
        <div class="chat-input">
            <textarea id="userQuestion" placeholder="Type your question here..."></textarea>
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
    function sendMessage() {
        const userQuestion = document.getElementById('userQuestion').value;
        if (!userQuestion.trim()) return;

        // Add user message to chat
        addMessageToChat('user', userQuestion);

        // Clear input
        document.getElementById('userQuestion').value = '';

        // Send to backend
        fetch('/api/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ question: userQuestion })
        })
        .then(response => response.json())
        .then(data => {
            addMessageToChat('assistant', data.response);
        })
        .catch(error => {
            console.error('Error:', error);
            addMessageToChat('error', 'Sorry, an error occurred.');
        });
    }

    function addMessageToChat(type, message) {
        const chatHistory = document.getElementById('chatHistory');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}-message`;
        messageDiv.textContent = message;
        chatHistory.appendChild(messageDiv);
        chatHistory.scrollTop = chatHistory.scrollHeight;
    }
    </script>

    <style>
    .chat-container {
        max-width: 800px;
        margin: 20px auto;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .chat-history {
        height: 400px;
        overflow-y: auto;
        padding: 20px;
        background: #f9f9f9;
    }

    .chat-input {
        padding: 20px;
        border-top: 1px solid #ccc;
        display: flex;
        gap: 10px;
    }

    .chat-input textarea {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: none;
    }

    .chat-input button {
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .message {
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 4px;
    }

    .user-message {
        background: #e3f2fd;
        margin-left: 20%;
    }

    .assistant-message {
        background: #f5f5f5;
        margin-right: 20%;
    }

    .error-message {
        background: #ffebee;
        color: #c62828;
    }
    </style>
</body>
</html>